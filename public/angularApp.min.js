var coreModule=angular.module("coreModule",["ngRoute","ngAnimate","timer","ui.bootstrap","ui.bootstrap.showErrors","angularFileUpload","duScroll","plangular"]).directive("datepickerPopup",function(){return{restrict:"EAC",require:"ngModel",link:function(e,o,r,t){t.$formatters.shift()}}}).directive("disableNgAnimate",["$animate",function(e){return{restrict:"A",link:function(o,r){e.enabled(!1,r)}}}]);coreModule.config(["$routeProvider",function(e){e.when("/",{templateUrl:"/views/index.html",controller:"indexCtrl"}).when("/profile/:formId",{templateUrl:"/views/registration.html",controller:"registrationCtrl"}).otherwise({redirectTo:"/views/404.html"})}]),coreModule.factory("registrationSrvc",["$http","$q","$timeout",function(e,o){var r={profile:!1,getProfile:function(t){var l=o.defer(),n={method:"POST",url:"api/profile/"+t,headers:{"Content-Type":"application/json"},data:{id:t}};return e(n).success(function(e){(e.result="Success")&&(r.profile=e.profile,l.resolve(r.profile))}).error(function(){console.log("error"),l.reject("Impossible de récupérer le profile")}),l.promise}};return r}]),coreModule.controller("indexCtrl",["$scope","$http","$timeout","$document","$window","$location","$anchorScroll",function(e,o,r,t,l,n,i){e.alerts=[],e.subbed=!1,e.menuCollapsed=!0,e.boundingValue=0,e.scrollValue=0,e.showText=!1,e.conceptCollapsed=!0,e.addAlert=function(o,t){var l={type:o,message:t};console.log(l.type),console.log(l.message),console.log("Adding alert: "+l),e.alerts.push(l),r(function(){console.log("Removing alert: "+l),e.alerts.splice(e.alerts.indexOf(l),1)},5e3)},e.save=function(){if(e.$broadcast("show-errors-check-validity"),console.log("hitted save"),e.subbed)e.addAlert("danger","Vous avez déjà envoyé un formulaire d' inscription");else if(e.form.$valid){var r={method:"POST",url:"/api/forms/create",headers:{"Content-Type":"application/json"},data:e.form};o(r).success(function(o){(o.result="Success")&&(e.subbed=!0,e.addAlert("success","Merci, plus d' informations vous ont été acheminées par courriel."))}).error(function(){console.log("danger"),e.addAlert("danger","Un erreur est survenu lors du traitement de la demande, veuillez réessayer")})}},t.on("scroll",function(){var o=angular.element(document.getElementById("scrollStart"));e.showText=o[0].getBoundingClientRect().top-l.innerHeight<0,e.$apply()}),e.scrollTo=function(e){console.log(e),n.hash(e),i()}}]),coreModule.controller("registrationCtrl",["$scope","$http","$timeout","$routeParams","registrationSrvc","FileUploader",function(e,o,r,t,l,n){e.alerts=[],e.formId=t.formId,e.loading=!0,e.uploader=new n,e.profile=l.getProfile(e.formId).then(function(o){console.log(o),e.loading=!1,e.profile=o,e.showAttachments=o.attachments.length>0,e.uploader.url="/api/profile/"+o._id+"/upload",e.uploader.filters.push({name:"imageFilter",fn:function(e){var o="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(o)}})},function(){}),e.addAlert=function(o,t){var l={type:o,message:t};console.log(l.type),console.log(l.message),console.log("Adding alert: "+l),e.alerts.push(l),r(function(){console.log("Removing alert: "+l),e.alerts.splice(e.alerts.indexOf(l),1)},5e3)},e.saveProfile=function(){e.uploader.queue.length>0&&e.uploader.uploadAll();var r={portfolioLink:e.profile.portfolioLink,customMessage:e.profile.customMessage},t={method:"POST",url:"/api/profile/"+e.profile._id+"/update",headers:{"Content-Type":"application/json"},data:r};o(t).success(function(o){(o.result="Success")?e.addAlert("success",o.message):e.addAlert("danger",o.message)}).error(function(){e.addAlert("danger","Impossible d'acheminer la requête")})}}]);